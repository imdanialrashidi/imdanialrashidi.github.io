---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from '../layouts/BaseLayout.astro';
import SectionTitle from '../components/SectionTitle.astro';
import ProjectCard from '../components/ProjectCard.astro';
import PostCard from '../components/PostCard.astro';
import { withBase } from '../utils/withBase';
import { socialLinks, resumePath } from '../data/socialLinks';
import profileImage from '../assets/danial-profile.jpg';

const projects = (await getCollection('projects')).sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const posts = (await getCollection('blog')).sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const featuredProjects = projects.filter((entry) => entry.data.featured).slice(0, 3);
const showcase = (featuredProjects.length >= 3 ? featuredProjects : projects.slice(0, 3)).slice(0, 3);
const latestPosts = posts.slice(0, 2);

const stack = ['Linux', 'Python', 'Docker', 'GitHub Actions', 'Nginx', 'Prometheus', 'Grafana'];
const currentFocus = [
  'Building security engineering foundations through Linux hardening and secure service configuration.',
  'Learning DevSecOps workflows: secrets handling, dependency checks, and safer CI/CD pipelines.',
  'Practicing SRE habits: observability, alert quality, incident notes, and service reliability baselines.',
  'Exploring AI/LLM security fundamentals for cloud-native systems.'
];

const personStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: 'Danial Rashidi',
  jobTitle: 'Aspiring Cloud Security / DevSecOps + SRE Engineer',
  description:
    'Computer Engineering student building practical Cloud Security, DevSecOps, and SRE skills through public projects and engineering logs.',
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'Karaj',
    addressCountry: 'IR'
  },
  knowsAbout: ['Cloud Security', 'DevSecOps', 'SRE', 'Linux Hardening', 'AI/LLM Security'],
  url: new URL(Astro.url.pathname, Astro.site ?? Astro.url).toString(),
  sameAs: socialLinks.map((item) => item.url)
};
---

<BaseLayout
  title="Danial Rashidi | Cloud Security, DevSecOps + SRE"
  description="Portfolio of Danial Rashidi, an aspiring Cloud Security / DevSecOps + SRE engineer focused on practical, security-first infrastructure work."
  ogImage="images/danial-profile.jpg"
  structuredData={personStructuredData}
>
  <section class="hero-grid hero-grid-main">
    <div class="hero-copy">
      <p class="kicker mb-4">Based in Karaj, Iran · Open to worldwide remote collaboration</p>
      <h1 class="hero-title">Danial Rashidi</h1>
      <p class="hero-subtitle">
        Aspiring Cloud Security / DevSecOps + SRE Engineer.
        I am building strong foundations in secure systems, reliable operations, and production-focused engineering habits.
      </p>

      <div class="hero-actions">
        <a class="btn-primary" href={withBase(resumePath)} download>Download Resume</a>
        <a class="btn-ghost" href={withBase('contact')}>Open to Internship Collaboration</a>
      </div>

      <ul class="hero-metrics" role="list" aria-label="Quick profile metrics">
        <li><span class="hero-metric-label">Primary Focus</span><span class="hero-metric-value">Cloud Security</span></li>
        <li><span class="hero-metric-label">Engineering Path</span><span class="hero-metric-value">DevSecOps + SRE</span></li>
        <li><span class="hero-metric-label">Current Stage</span><span class="hero-metric-value">Junior Builder</span></li>
        <li><span class="hero-metric-label">Special Interest</span><span class="hero-metric-value">AI / LLM Security</span></li>
      </ul>
    </div>

    <aside class="glass hero-profile" aria-label="Profile">
      <div class="hero-photo">
        <Image
          src={profileImage}
          alt="Portrait of Danial Rashidi"
          width={600}
          height={750}
          formats={['avif', 'webp']}
          quality={68}
          sizes="(max-width: 820px) min(76vw, 360px), 28vw"
          class="hero-photo-image"
          loading="eager"
          fetchpriority="high"
          decoding="async"
        />
        <p class="hero-photo-caption">Danial Rashidi · Cloud Security / DevSecOps + SRE</p>
      </div>

      <p class="kicker mb-3 mt-4">Current Focus</p>
      <ul class="space-y-2 text-sm text-muted md:text-base">
        {currentFocus.map((item) => <li>{item}</li>)}
      </ul>
    </aside>
  </section>

  <section class="defer-section mt-20 md:mt-24">
    <SectionTitle
      eyebrow="Work"
      title="Featured Projects"
      subtitle="Practical portfolio work aligned with security-first infrastructure and reliability outcomes."
    />
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {
        showcase.map((project) => (
          <ProjectCard
            href={withBase(`work/${project.slug}`)}
            title={project.data.title}
            summary={project.data.summary}
            tags={project.data.tags}
            date={project.data.date}
            status={project.data.status}
          />
        ))
      }
    </div>
  </section>

  <section class="defer-section mt-20">
    <SectionTitle
      eyebrow="Writing"
      title="Latest Blog"
      subtitle="Concise logs from my Cloud Security, DevSecOps, and SRE growth process."
    />
    <div class="grid gap-4 md:grid-cols-2">
      {
        latestPosts.map((post) => (
          <PostCard
            href={withBase(`blog/${post.slug}`)}
            title={post.data.title}
            excerpt={post.data.excerpt}
            date={post.data.date}
            readingTime={post.data.readingTime}
            tags={post.data.tags}
          />
        ))
      }
    </div>
  </section>

  <section class="defer-section mt-20">
    <SectionTitle
      eyebrow="Core Stack"
      title="Tools I Use"
      subtitle="A compact toolset optimized for secure delivery, observability, and fast iteration."
    />
    <ul class="flex flex-wrap gap-3">
      {stack.map((item) => <li class="chip px-3 py-2 text-sm">{item}</li>)}
    </ul>
  </section>
</BaseLayout>

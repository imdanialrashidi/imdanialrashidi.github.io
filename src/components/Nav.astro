---
import { withBase } from '../utils/withBase';
import { resumePath } from '../data/socialLinks';

const links = [
  { path: '', label: 'Home' },
  { path: 'work', label: 'Work' },
  { path: 'blog', label: 'Blog' },
  { path: 'contact', label: 'Contact' }
];

const pathname = Astro.url.pathname.replace(/\/$/, '') || '/';
const basePath = import.meta.env.BASE_URL.replace(/\/$/, '');
const routePath = pathname.startsWith(basePath) ? pathname.slice(basePath.length) || '/' : pathname;

const isActive = (path: string) => {
  const target = path ? `/${path}` : '/';
  if (target === '/') return routePath === '/';
  return routePath === target || routePath.startsWith(`${target}/`);
};
---

<header class="site-header">
  <div class="shell">
    <nav class="glass nav-shell nav-orbit" aria-label="Primary">
      <a href={withBase()} class="orbit-brand" aria-label="Go to homepage">
        <span class="orbit-mark" aria-hidden="true">DR</span>
        <span class="orbit-brand-text">
          <strong>Danial Rashidi</strong>
          <small>Security Path</small>
        </span>
      </a>

      <ul class="orbit-links" role="list">
        {
          links.map((link) => (
            <li>
              <a href={withBase(link.path)} class:list={['orbit-link', isActive(link.path) && 'orbit-link-active']}>
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>

      <div class="orbit-actions">
        <a href={withBase(resumePath)} class="orbit-resume" download>
          Resume
        </a>
        <a href={withBase('contact')} class="orbit-contact">
          Contact
        </a>
      </div>

      <details class="orbit-mobile">
        <summary class="orbit-mobile-toggle">Menu</summary>
        <div class="glass orbit-mobile-panel">
          <ul role="list">
            {
              links.map((link) => (
                <li>
                  <a href={withBase(link.path)} class:list={['orbit-mobile-link', isActive(link.path) && 'orbit-mobile-link-active']}>
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
          <div class="orbit-mobile-actions">
            <a href={withBase(resumePath)} class="orbit-mobile-btn" download>
              Download Resume
            </a>
            <a href={withBase('contact')} class="orbit-mobile-btn orbit-mobile-btn-secondary">
              Contact
            </a>
          </div>
        </div>
      </details>
    </nav>
  </div>
</header>
